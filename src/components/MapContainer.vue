<template>
  <div id="mapContainer" class="size-full" />
</template>

<script lang="ts" setup>
import AMapLoader from '@amap/amap-jsapi-loader'
import { getPointListApi, type Point, type PointParams } from '../api/mapApi'
import icon1 from '../assets/images/point-mark-1.png'
import icon2 from '../assets/images/point-mark-2.png'
import icon3 from '../assets/images/point-mark-3.png'
import icon4 from '../assets/images/point-mark-4.png'
import icon5 from '../assets/images/point-mark-5.png'
import icon6 from '../assets/images/point-mark-6.png'
import '@amap/amap-jsapi-types'

const map = ref<AMap.Map>()
const pointList = ref<Point[]>([])
const markers = ref<AMap.Marker[]>([])

// 自定义标记点 icon
const iconHashMap = reactive<Record<string, string>>({
  1: icon1,
  2: icon2,
  3: icon3,
  4: icon4,
  5: icon5,
  6: icon6,
})

onMounted(() => {
  initMap()
})
onUnmounted(() => {
  map.value?.destroy()
})

const initMap = () => {
  window._AMapSecurityConfig = {
    securityJsCode: 'bc8b3af87fd871287b2e681071295c32',
  }
  AMapLoader.load({
    key: '28a319a83761ce873ce8c4618a8d3fe0',
    version: '2.0',
    plugins: ['AMap.GeoJSON', 'AMap.Marker'], // 需要使用的的插件列表，如比例尺'AMap.Scale'等
    Loca: {
      // 是否加载 Loca， 缺省不加载
      version: '2.0.0', // Loca 版本，缺省 1.3.2
    },
  })
    .then(async (AMap) => {
      map.value = new AMap.Map('mapContainer', {
        viewMode: '2D',
        zoom: 9.5,
        center: [121.138825, 27.893054],
        mapStyle: 'amap://styles/grey',
      })

      // 绘制区域
      areas.value.map((area) => {
        const path = area.lngLats.map(point => new AMap.LngLat(point[0], point[1]))
        // 创建多边形实例
        const polygon = new AMap.Polygon({
          path,
          strokeWeight: 1,
          fillColor: area.color, // 整体颜色
          strokeColor: 'transparent', // 边框颜色
        })

        // 将多边形添加到地图
        map.value?.add(polygon)
      })

      // 标记点位
      await getPointList()
      setMapPoint()
    })
    .catch((e) => {
      console.log(e)
    })
}

const params = reactive<Partial<PointParams>>({})
const getPointList = async () => {
  const response = await getPointListApi(params)
  pointList.value = response.data.data
}

const setMapPoint = () => {
  pointList.value.forEach((point) => {
    const icon = iconHashMap[point.remark]

    const marker = new AMap.Marker({
      map: map.value,
      position: [parseFloat(point.lon), parseFloat(point.lat)],
      icon,
    })
    marker.on('click', () => {
      console.log('点位信息')
      console.log(point)
    })
    markers.value.push(marker)
  })
}
// 筛选点位数据
// const onClickPointType = async () => {
//   map?.remove(markers.value)
//   await getPointList()
//   setMapPoint()
// }

// 绘制多边形区域
type Area = {
  id: number
  name: string
  color: string
  lngLats: string[][]
}
const areas = ref<Area[]>([
  {
    id: 1,
    name: '南麂列岛诸湾',
    color: '#3366CC',
    lngLats: [
      ['121.170768', '27.476458'],
      ['121.133335', '27.53401'],
      ['121.046184', '27.535607'],
      ['120.983741', '27.461397'],
      ['121.083772', '27.394672'],
      ['121.170768', '27.476458'],
    ],
  },
  {
    id: 2,
    name: '北麂列岛诸湾',
    color: '#FF9900',
    lngLats: [
      ['121.188334', '27.675152'],
      ['121.151281', '27.621684'],
      ['121.200485', '27.579492'],
      ['121.270805', '27.617095'],
      ['121.253275', '27.658744'],
      ['121.188334', '27.675152'],
    ],
  },
  {
    id: 3,
    name: '沿浦湾',
    color: '#66CC00',
    lngLats: [
      ['120.524664', '27.196272'],
      ['120.509471', '27.186583'],
      ['120.500489', '27.188113'],
      ['120.48434', '27.163376'],
      ['120.466472', '27.173408'],
      ['120.466663', '27.188878'],
      ['120.470867', '27.192533'],
      ['120.46953', '27.196867'],
      ['120.467523', '27.196952'],
      ['120.462172', '27.20868'],
      ['120.466472', '27.211909'],
      ['120.45835', '27.219472'],
      ['120.44975', '27.215223'],
      ['120.450897', '27.208765'],
      ['120.446597', '27.20613'],
      ['120.445259', '27.211824'],
      ['120.435608', '27.211484'],
      ['120.435322', '27.199332'],
      ['120.426913', '27.183863'],
      ['120.439144', '27.174683'],
      ['120.436659', '27.164737'],
      ['120.462625', '27.113449'],
      ['120.533435', '27.097659'],
      ['120.596975', '27.173484'],
      ['120.524664', '27.196272'],
    ],
  },
  {
    id: 4,
    name: '渔寮湾',
    color: '#9933CC',
    lngLats: [
      ['120.557308', '27.293351'],
      ['120.555999', '27.290675'],
      ['120.550239', '27.288348'],
      ['120.547489', '27.286138'],
      ['120.554035', '27.284392'],
      ['120.5433', '27.27299'],
      ['120.537016', '27.275201'],
      ['120.5361', '27.271477'],
      ['120.531518', '27.271477'],
      ['120.523925', '27.275317'],
      ['120.52735', '27.27063'],
      ['120.524993', '27.267837'],
      ['120.527874', '27.257829'],
      ['120.525124', '27.257597'],
      ['120.52303', '27.258411'],
      ['120.520281', '27.256084'],
      ['120.52303', '27.244445'],
      ['120.540965', '27.24235'],
      ['120.541817', '27.239313'],
      ['120.538589', '27.234529'],
      ['120.530338', '27.230382'],
      ['120.536616', '27.22193'],
      ['120.531056', '27.220494'],
      ['120.520832', '27.223365'],
      ['120.519577', '27.220973'],
      ['120.522626', '27.216188'],
      ['120.521012', '27.215709'],
      ['120.518321', '27.216188'],
      ['120.514375', '27.210286'],
      ['120.518142', '27.20901'],
      ['120.513658', '27.204703'],
      ['120.51581', '27.201513'],
      ['120.51868', '27.202948'],
      ['120.524664', '27.196272'],
      ['120.596975', '27.173484'],
      ['120.649275', '27.278832'],
      ['120.557308', '27.293351'],
    ],
  },
  {
    id: 5,
    name: '大渔湾',
    color: ' #FF0000',
    lngLats: [
      ['120.692453', '27.473873'],
      ['120.667143', '27.449016'],
      ['120.670583', '27.445527'],
      ['120.66272', '27.44073'],
      ['120.660079', '27.445192'],
      ['120.653923', '27.445569'],
      ['120.652544', '27.436244'],
      ['120.653923', '27.43615'],
      ['120.652968', '27.430216'],
      ['120.651164', '27.431723'],
      ['120.646813', '27.424376'],
      ['120.642886', '27.422963'],
      ['120.645539', '27.414296'],
      ['120.648193', '27.413542'],
      ['120.645327', '27.411752'],
      ['120.645858', '27.408549'],
      ['120.641613', '27.4061'],
      ['120.642356', '27.402802'],
      ['120.645858', '27.402425'],
      ['120.646919', '27.401294'],
      ['120.65074', '27.404781'],
      ['120.651376', '27.397149'],
      ['120.641703', '27.393336'],
      ['120.641039', '27.391568'],
      ['120.645464', '27.390193'],
      ['120.64834', '27.392354'],
      ['120.654093', '27.392158'],
      ['120.655199', '27.389997'],
      ['120.650774', '27.387443'],
      ['120.654978', '27.381942'],
      ['120.64834', '27.380371'],
      ['120.652101', '27.374084'],
      ['120.649225', '27.361116'],
      ['120.63772', '27.367993'],
      ['120.635729', '27.366421'],
      ['120.635065', '27.361509'],
      ['120.625551', '27.361116'],
      ['120.619578', '27.365831'],
      ['120.621348', '27.369172'],
      ['120.626658', '27.371529'],
      ['120.62356', '27.377031'],
      ['120.617144', '27.37428'],
      ['120.615153', '27.37487'],
      ['120.617808', '27.377227'],
      ['120.616259', '27.379978'],
      ['120.612276', '27.381746'],
      ['120.617144', '27.388032'],
      ['120.608958', '27.385479'],
      ['120.60763', '27.387443'],
      ['120.602984', '27.385871'],
      ['120.605196', '27.382335'],
      ['120.599223', '27.377424'],
      ['120.594576', '27.378799'],
      ['120.59347', '27.381746'],
      ['120.58816', '27.381156'],
      ['120.57931', '27.390193'],
      ['120.580195', '27.391961'],
      ['120.566257', '27.396872'],
      ['120.566478', '27.400408'],
      ['120.562495', '27.400997'],
      ['120.560283', '27.399819'],
      ['120.552097', '27.402372'],
      ['120.547008', '27.396872'],
      ['120.557849', '27.388229'],
      ['120.55099', '27.387836'],
      ['120.545459', '27.391372'],
      ['120.545459', '27.3843'],
      ['120.551654', '27.37821'],
      ['120.555415', '27.381746'],
      ['120.559398', '27.378799'],
      ['120.560947', '27.380567'],
      ['120.562938', '27.374477'],
      ['120.559177', '27.373101'],
      ['120.557407', '27.371136'],
      ['120.561389', '27.368975'],
      ['120.555858', '27.36308'],
      ['120.547008', '27.361509'],
      ['120.544353', '27.354827'],
      ['120.539707', '27.357186'],
      ['120.53329', '27.345198'],
      ['120.541034', '27.339892'],
      ['120.5386', '27.337337'],
      ['120.535411', '27.336683'],
      ['120.530742', '27.337119'],
      ['120.531725', '27.3345'],
      ['120.521159', '27.334063'],
      ['120.513541', '27.336901'],
      ['120.51821', '27.329697'],
      ['120.524599', '27.327514'],
      ['120.529514', '27.323148'],
      ['120.533445', '27.325549'],
      ['120.545732', '27.326423'],
      ['120.548189', '27.325768'],
      ['120.543766', '27.319437'],
      ['120.547206', '27.315288'],
      ['120.566128', '27.325986'],
      ['120.568339', '27.32031'],
      ['120.559984', '27.320528'],
      ['120.555807', '27.31507'],
      ['120.563179', '27.31245'],
      ['120.557281', '27.308956'],
      ['120.559739', '27.305245'],
      ['120.544749', '27.29651'],
      ['120.56023', '27.298475'],
      ['120.557308', '27.293351'],
      ['120.649275', '27.278832'],
      ['120.710864', '27.365493'],
      ['120.776229', '27.465835'],
      ['120.692453', '27.473873'],
    ],
  },
  {
    id: 6,
    name: '温州湾',
    color: '#009999',
    lngLats: [
      ['121.005214', '28.004039'],
      ['120.958189', '27.978008'],
      ['120.955381', '27.955072'],
      ['120.836765', '27.767056'],
      ['120.80869', '27.780719'],
      ['120.80097', '27.770783'],
      ['120.777808', '27.78134'],
      ['120.75605', '27.726681'],
      ['120.725869', '27.706177'],
      ['120.706919', '27.707419'],
      ['120.675335', '27.621012'],
      ['120.635328', '27.581204'],
      ['120.61357', '27.573739'],
      ['120.643049', '27.55445'],
      ['120.674633', '27.490962'],
      ['120.692453', '27.473873'],
      ['120.776229', '27.465835'],
      ['120.811498', '27.555695'],
      ['120.897828', '27.586803'],
      ['120.984158', '27.62039'],
      ['120.99609', '27.667643'],
      ['120.969419', '27.694369'],
      ['120.963804', '27.749666'],
      ['120.982754', '27.785686'],
      ['121.027674', '27.93213'],
      ['120.989071', '27.956932'],
      ['121.027674', '27.997222'],
      ['121.005214', '28.004039'],
    ],
  },
  {
    id: 7,
    name: '洞头诸湾',
    color: '#CCCC00',
    lngLats: [
      ['121.027674', '27.93213'],
      ['120.982754', '27.785686'],
      ['120.963804', '27.749666'],
      ['121.144601', '27.734345'],
      ['121.216643', '27.759513'],
      ['121.269726', '27.833862'],
      ['121.281101', '27.916538'],
      ['121.100994', '27.93803'],
      ['121.027674', '27.93213'],
    ],
  },
  {
    id: 8,
    name: '大门镇诸湾',
    color: '#666666',
    lngLats: [
      ['121.050956', '28.033971'],
      ['121.027674', '27.997222'],
      ['120.989071', '27.956932'],
      ['121.027674', '27.93213'],
      ['121.027674', '27.93213'],
      ['121.100994', '27.93803'],
      ['121.281101', '27.916538'],
      ['121.340402', '28.014073'],
      ['121.26407', '28.035328'],
      ['121.144194', '28.012264'],
      ['121.050956', '28.033971'],
    ],
  },
  {
    id: 9,
    name: '乐清湾-温州段',
    color: '#CC0066',
    lngLats: [
      ['121.199584', '28.386956'],
      ['121.186951', '28.385104'],
      ['121.180634', '28.370901'],
      ['121.189758', '28.358549'],
      ['121.188354', '28.353607'],
      ['121.171509', '28.351137'],
      ['121.153261', '28.340636'],
      ['121.152559', '28.322719'],
      ['121.132205', '28.30789'],
      ['121.140627', '28.294913'],
      ['121.124484', '28.282552'],
      ['121.0929', '28.281933'],
      ['121.091496', '28.276989'],
      ['121.117465', '28.275134'],
      ['121.135012', '28.242987'],
      ['121.12659', '28.2065'],
      ['121.101322', '28.172476'],
      ['121.097111', '28.141535'],
      ['121.080968', '28.1502'],
      ['121.029029', '28.109967'],
      ['121.022011', '28.110586'],
      ['121.007973', '28.084581'],
      ['121.017098', '28.078389'],
      ['121.014992', '28.034412'],
      ['121.003762', '28.033173'],
      ['121.011483', '28.022641'],
      ['121.005214', '28.004039'],
      ['121.027674', '27.997222'],
      ['121.050956', '28.033971'],
      ['121.144194', '28.012264'],
      ['121.087987', '28.100061'],
      ['121.144136', '28.19784'],
      ['121.146944', '28.27328'],
      ['121.162385', '28.295531'],
      ['121.194671', '28.280697'],
      ['121.217833', '28.346195'],
      ['121.217131', '28.357931'],
      ['121.208709', '28.36596'],
      ['121.199584', '28.386956'],
    ],
  },
])
</script>
